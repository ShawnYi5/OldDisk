## 名词说明
* 磁盘快照存储：“物理”上的备份数据，可以是 qcow中的一个快照点，或者一个cdp文件

## API接口
* 该类接口同步执行相关功能

#### 创建磁盘快照存储
* 入参
  * 新建的磁盘快照存储标识
  * 调用者 PID
  * 跟踪数据：如什么任务，为什么创建，等等，debug用
  * 磁盘快照存储写句柄（全局唯一）
    - 设计原因：后期可支持幂等
    - 设计原因：后期通过异步销毁补偿，可防止出现网络应答失败，导致资源泄漏
* 返回
  * 成功
    *  QemuImg原生句柄 和 QemuImg网络接口
  * 失败
    * 原因
* 效果
  * 传入参数持久化
  * 根据 当前实际存储文件 与 “日志”接口 的数据，计算出当前最适应的 快照链，并“锁定”
  * 调用QemuImg接口创建快照存储

#### 关闭磁盘快照存储句柄
* 入参
  * 磁盘快照存储写、读句柄
* 返回
  * 成功
  * 失败：放入异步关闭？目前仅仅依靠PID可进行跟踪绝大部分，但后续在不同主机上的话，就需要额外的机制
* 备注
  * 这里不传入QemuImg close接口需要的success参数，不保留的时候，依靠上层代码处理

#### 打开磁盘快照存储
* 入参
  * 磁盘快照存储标识
  * 时刻（可选，为CDP时有效，不一定是CDP文件中存在的时刻点，而是逻辑上存在的时刻点）
  * 调用者 PID
  * 跟踪数据：如什么任务，为什么创建，等等，debug用
  * 磁盘快照存储读句柄（全局唯一）
* 返回
  * 成功
    * QemuImg原生句柄 和 QemuImg网络接口
  * 失败
    * 原因

#### 获取磁盘快照存储的元数据（通过句柄）
* 入参
  * 磁盘快照存储读、写句柄
  * 元数据类型：
    暂时没想到必须要通过句柄获取的值
* 返回
  * 略

#### 获取磁盘快照存储的元数据（通过快照存储标识）
* 入参
  * 磁盘快照存储标识
  * 时刻（可选，为CDP时，可能需要）
  * 元数据类型：
    * 该快照点的全量hash：附加 记录的文件路径
    * 该快照点的位图：附加 记录的文件路径
    * 该快照点为末端，向前多少秒的IO情况：附加 记录的文件路径，向前多少秒
    * 该快照存储的开始时间与结束时间（CDP）-> 修正主机快照的最后时刻
* 返回
  * 略

## 日志型接口
* 该类型接口仅仅是持久化记录调用的时序与参数，然后立刻返回。真正完成数据处理的过程为异步执行
* 非幂等，不可自动重试

#### 创建磁盘快照存储
* 入参
  * 父磁盘快照存储标识
  * 父磁盘快照存储的时刻（可选，父快照为CDP时，可能需要）
  * 新建磁盘快照存储标识（全局唯一）
  * 新建磁盘快照存储类型（QCOW 或者 CDP）
  * 新建磁盘快照存储实际存储数据的目录
  * 新建磁盘快照的描述的磁盘大小
  * hash算法：无，V1算法（MD4+CRC）

#### 删除磁盘快照存储
* 入参
  * N个磁盘快照存储标识，批量写入
* 备注
  * 考虑删除优化，一次传入一批
  * 不需要分辨 删除 还是 合并

#### 从qcow类型的备份数据 创建 qcow快照点
跨qcow合并
* 入参
  * 源逻辑磁盘快照标识
  * 新建逻辑磁盘快照标识
  * 父逻辑磁盘快照标识

#### 从cdp类型的备份数据 创建 qcow快照点
cdp合并
* 入参
  * 一组源逻辑磁盘快照标识
  * 新建逻辑磁盘快照标识
  * 父逻辑磁盘快照标识
* 备注
  * 考虑合并优化，支持一次合并一组CDP文件
